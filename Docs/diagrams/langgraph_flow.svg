<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="nodeGrad1" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2E5C8A;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#50C878;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2E7D4E;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad3" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C92A2A;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad4" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FFD93D;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#F59F00;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad5" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9B59B6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6C3483;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="#2C3E50" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#2C3E50">
    LangGraph - Flujo de Procesamiento Multi-Agente
  </text>
  
  <!-- Entry Point -->
  <circle cx="700" cy="100" r="40" fill="url(#nodeGrad1)" stroke="#2C3E50" stroke-width="3"/>
  <text x="700" y="95" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">ENTRY</text>
  <text x="700" y="110" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">user_query</text>
  
  <!-- Intent Node -->
  <rect x="600" y="200" width="200" height="100" rx="10" fill="url(#nodeGrad1)" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="230" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">INTENT</text>
  <text x="700" y="250" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Router LLM / Heurístico</text>
  <text x="700" y="270" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">CALENDAR | EMAIL |</text>
  <text x="700" y="285" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">SCHEDULING | COMMS | GENERAL</text>
  
  <!-- RAG Node -->
  <rect x="600" y="350" width="200" height="100" rx="10" fill="url(#nodeGrad2)" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="380" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">RAG</text>
  <text x="700" y="400" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Retrieval Context</text>
  <text x="700" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Supabase pgvector</text>
  <text x="700" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Top-K chunks + Citations</text>
  
  <!-- Conflict Check Node -->
  <rect x="600" y="500" width="200" height="100" rx="10" fill="url(#nodeGrad3)" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">CONFLICT_CHECK</text>
  <text x="700" y="550" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Verifica Solapamientos</text>
  <text x="700" y="570" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">list_agenda_events</text>
  <text x="700" y="585" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">±60min, mismo título</text>
  
  <!-- Policy Node -->
  <rect x="600" y="650" width="200" height="100" rx="10" fill="url(#nodeGrad4)" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">POLICY</text>
  <text x="700" y="700" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Validación de Políticas</text>
  <text x="700" y="720" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Horario laboral (09-19)</text>
  <text x="700" y="735" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Requiere confirmación</text>
  
  <!-- Agent Node -->
  <rect x="200" y="500" width="200" height="100" rx="10" fill="url(#nodeGrad5)" stroke="#2C3E50" stroke-width="2"/>
  <text x="300" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">AGENT</text>
  <text x="300" y="550" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Agente Especializado</text>
  <text x="300" y="570" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">CalendarAgent</text>
  <text x="300" y="585" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">EmailAgent | SchedulingAgent</text>
  
  <!-- Plan Node -->
  <rect x="200" y="650" width="200" height="100" rx="10" fill="url(#nodeGrad5)" stroke="#2C3E50" stroke-width="2"/>
  <text x="300" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">PLAN</text>
  <text x="300" y="700" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Planificación de Tools</text>
  <text x="300" y="720" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">tool_plan: [tool1, tool2]</text>
  <text x="300" y="735" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">tool_plan_details: args</text>
  
  <!-- Tool Node -->
  <rect x="1000" y="500" width="200" height="100" rx="10" fill="url(#nodeGrad3)" stroke="#2C3E50" stroke-width="2"/>
  <text x="1100" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">TOOL</text>
  <text x="1100" y="550" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Ejecución de Herramientas</text>
  <text x="1100" y="570" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">MCP o Local Registry</text>
  <text x="1100" y="585" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">tool_results</text>
  
  <!-- Response Node -->
  <rect x="1000" y="650" width="200" height="100" rx="10" fill="url(#nodeGrad2)" stroke="#2C3E50" stroke-width="2"/>
  <text x="1100" y="680" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">RESPONSE</text>
  <text x="1100" y="700" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">Generación de Respuesta</text>
  <text x="1100" y="720" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">final_text</text>
  <text x="1100" y="735" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">citations</text>
  
  <!-- END Node -->
  <circle cx="1100" cy="800" r="40" fill="url(#nodeGrad1)" stroke="#2C3E50" stroke-width="3"/>
  <text x="1100" y="795" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">END</text>
  <text x="1100" y="810" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Resultado</text>
  
  <!-- Arrows -->
  <path d="M 700 140 L 700 200" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 700 300 L 700 350" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 700 450 L 700 500" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 700 600 L 700 650" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 550 L 400 550" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 300 600 L 300 650" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 700 L 1000 550" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 1100 600 L 1100 650" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 1100 750 L 1100 760" stroke="#2C3E50" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Labels on arrows -->
  <text x="350" y="620" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">planifica</text>
  <text x="700" y="175" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">rutea</text>
  <text x="700" y="325" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">recupera</text>
  <text x="700" y="475" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">verifica</text>
  <text x="700" y="625" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">valida</text>
  <text x="700" y="625" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">valida</text>
  <text x="700" y="625" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2C3E50">valida</text>
  
  <!-- State Information Box -->
  <rect x="50" y="200" width="300" height="250" rx="10" fill="#ECF0F1" stroke="#BDC3C7" stroke-width="2" opacity="0.9"/>
  <text x="200" y="225" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2C3E50">AgentState (TypedDict)</text>
  <text x="70" y="250" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• user_query: str</text>
  <text x="70" y="270" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• intent: Intent</text>
  <text x="70" y="290" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• agent: str</text>
  <text x="70" y="310" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• rag_context: List[Dict]</text>
  <text x="70" y="330" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• policy: Dict[str, Any]</text>
  <text x="70" y="350" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• tool_plan: List[str]</text>
  <text x="70" y="370" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• tool_plan_details: List[Dict]</text>
  <text x="70" y="390" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• tool_calls: List[Dict]</text>
  <text x="70" y="410" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• tool_results: List[Dict]</text>
  <text x="70" y="430" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• final_text: str</text>
  <text x="70" y="450" font-family="Arial, sans-serif" font-size="11" fill="#34495E">• citations: List[str]</text>
  
  <!-- Footer -->
  <text x="700" y="870" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#7F8C8D">
    Flujo: entry → intent → rag → conflict_check → policy → agent → plan → tool → response → END
  </text>
</svg>


